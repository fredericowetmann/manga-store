<div class="page-container">
    <mat-toolbar color="#fff">
        <span class="toolbar-title">Finalizar Compra</span>
    </mat-toolbar>
    <div class="form-container">
        <mat-card>
            <mat-card-content>
                <form [formGroup]="formGroup">
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Numero do cartão</mat-label>
                        <input matInput type="text" formControlName="cardNumber">
                        <mat-error *ngIf="formGroup.get('cardNumber')?.errors && 
                                        formGroup.get('cardNumber')?.touched">
                            @if (formGroup.get('cardNumber')?.errors?.['required']) {
                                <span>O Numero do cartão deve ser informado.</span>
                            } 
                            @if (formGroup.get('cardNumber')?.hasError('apiError')) {
                                <span>{{ formGroup.get('cardNumber')?.getError('apiError') }}</span>
                            }
                            @if (formGroup.get('cardNumber')?.errors?.['pattern']) {
                                <span>O cartão deve ser numero valido.</span>
                            }
                            @if (formGroup.get('cardNumber')?.errors?.['minlength']) {
                                <span>O Numero do cartão deve possuir exatamente 16 caracteres.</span>
                            }
                            @if (formGroup.get('cardNumber')?.errors?.['maxlength']) {
                                <span>O Numero do cartão deve possuir exatamente 16 caracteres.</span>
                            }
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Codigo CVV</mat-label>
                        <input matInput type="text" formControlName="cardCvv">
                        <mat-error *ngIf="formGroup.get('cardCvv')?.errors && 
                                        formGroup.get('cardCvv')?.touched">
                            @if (formGroup.get('cardCvv')?.errors?.['required']) {
                                <span>O Codigo CVV deve ser informado.</span>
                            } 
                            @if (formGroup.get('cardCvv')?.hasError('apiError')) {
                                <span>{{ formGroup.get('cardCvv')?.getError('apiError') }}</span>
                            }
                            @if (formGroup.get('cardCvv')?.errors?.['pattern']) {
                                <span>O CVV deve ser numero valido.</span>
                            }
                            @if (formGroup.get('cardCvv')?.errors?.['minlength']) {
                                <span>O Codigo CVV deve possuir exatamente 3 caracteres.</span>
                            }
                            @if (formGroup.get('cardCvv')?.errors?.['maxlength']) {
                                <span>O Codigo CVV deve possuir exatamente 3 caracteres.</span>
                            }
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Nome do proprietario</mat-label>
                        <input matInput type="text" formControlName="cardHolderName">
                        <mat-error *ngIf="formGroup.get('cardHolderName')?.errors && 
                                        formGroup.get('cardHolderName')?.touched">
                            @if (formGroup.get('cardHolderName')?.errors?.['required']) {
                                <span>O nome do proprietario deve ser informado.</span>
                            }
                            @if (formGroup.get('cardHolderName')?.hasError('apiError')) {
                                <span>{{ formGroup.get('cardHolderName')?.getError('apiError') }}</span>
                            }
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Data de Validade</mat-label>
                        <input matInput type="text" formControlName="cardExpiration">
                        <mat-error *ngIf="formGroup.get('cardExpiration')?.errors && 
                                        formGroup.get('cardExpiration')?.touched">
                            @if (formGroup.get('cardExpiration')?.errors?.['required']) {
                                <span>A data de validade deve ser informada.</span>
                            }
                            @if (formGroup.get('cardExpiration')?.hasError('apiError')) {
                                <span>{{ formGroup.get('cardExpiration')?.getError('apiError') }}</span>
                            }
                            @if (formGroup.get('cardExpiration')?.errors?.['pattern']) {
                                <span>A data de validade deve ser numero valido.</span>
                            }
                            @if (formGroup.get('cardExpiration')?.errors?.['minlength']) {
                                <span>A data de validade deve possuir exatamente 4 caracteres.</span>
                            }
                            @if (formGroup.get('cardExpiration')?.errors?.['maxlength']) {
                                <span>A data de validade deve possuir exatamente 4 caracteres.</span>
                            }
                        </mat-error>
                    </mat-form-field>
                    <h2 class="address">Endereço</h2>
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Nome</mat-label>
                        <input matInput type="text" formControlName="addressName">
                        <mat-error *ngIf="formGroup.get('addressName')?.errors && 
                                        formGroup.get('addressName')?.touched">
                            @if (formGroup.get('addressName')?.errors?.['required']) {
                                <span>O nome do endereço deve ser informado.</span>
                            }
                            @if (formGroup.get('addressName')?.hasError('apiError')) {
                                <span>{{ formGroup.get('addressName')?.getError('apiError') }}</span>
                            }
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>CEP</mat-label>
                        <input matInput type="text" formControlName="addressPostalCode">
                        <mat-error *ngIf="formGroup.get('addressPostalCode')?.errors && 
                                        formGroup.get('addressPostalCode')?.touched">
                            @if (formGroup.get('addressPostalCode')?.errors?.['required']) {
                                <span>O Cep deve ser informado.</span>
                            }
                            @if (formGroup.get('addressPostalCode')?.hasError('apiError')) {
                                <span>{{ formGroup.get('addressPostalCode')?.getError('apiError') }}</span>
                            }
                            @if (formGroup.get('addressPostalCode')?.errors?.['minlength']) {
                                <span>O Cep deve possuir exatamente 8 caracteres.</span>
                            }
                            @if (formGroup.get('addressPostalCode')?.errors?.['maxlength']) {
                                <span>O Cep deve possuir exatamente 8 caracteres.</span>
                            }
                            @if (formGroup.get('addressPostalCode')?.errors?.['pattern']) {
                                <span>O Cep deve ser numero valido.</span>
                            }
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Endereço</mat-label>
                        <input matInput type="text" formControlName="addressAddress">
                        <mat-error *ngIf="formGroup.get('addressAddress')?.errors && 
                                        formGroup.get('addressAddress')?.touched">
                            @if (formGroup.get('addressAddress')?.errors?.['required']) {
                                <span>O endereço deve ser informado.</span>
                            }
                            @if (formGroup.get('addressAddress')?.hasError('apiError')) {
                                <span>{{ formGroup.get('addressAddress')?.getError('apiError') }}</span>
                            }
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Complemento</mat-label>
                        <input matInput type="text" formControlName="addressComplement">
                        <mat-error *ngIf="formGroup.get('addressComplement')?.errors && 
                                        formGroup.get('addressComplement')?.touched">
                            @if (formGroup.get('addressComplement')?.errors?.['required']) {
                                <span>O complemento deve ser informado.</span>
                            }
                            @if (formGroup.get('addressComplement')?.hasError('apiError')) {
                                <span>{{ formGroup.get('addressComplement')?.getError('apiError') }}</span>
                            }
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="fill">
                        <mat-label>Cidade</mat-label>
                        <mat-select formControlName="addressCity">
                            @for (addressCity of city; track addressCity.id) {
                                <mat-option [value]="addressCity">
                                    {{addressCity.name}}, {{addressCity.state.acronym}}
                                </mat-option>
                            }
                        </mat-select>
                        <mat-error *ngIf="formGroup.get('addressCity')?.errors && 
                                        formGroup.get('addressCity')?.touched">
                            @if (formGroup.get('addressCity')?.errors?.['required']) {
                                <span>A cidade deve ser informada.</span>
                            }
                            @if (formGroup.get('addressCity')?.hasError('apiError')) {
                                <span>{{ formGroup.get('addressCity')?.getError('apiError') }}</span>
                            }
                        </mat-error>                    
                    </mat-form-field>
                </form>
            </mat-card-content>
            <mat-card-actions>
                <button mat-raised-button 
                        color="primary" 
                        (click)="finalizarCompra()"
                        [disabled]="formGroup.invalid">
                    Salvar 
                </button>
                <button mat-raised-button  
                        (click)="voltarPagina()"> 
                    Cancelar 
                </button>

            </mat-card-actions>
        </mat-card>
    </div>
</div>